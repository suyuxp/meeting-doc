.. _base_polyprop:

动态填报项
==========================


描述
------------------

源起
^^^^^^^^^^^^^^^^^^

由于学习会对学员有不同的需求，或者对于不同的学员，有不同的信息要求，因此，我们需要提供动态可配置的学员报名信息填报项。

但是，学员的信息本身，是需要进行统计分析的，所以，填报项中的核心部分，我们需要有一定的延续与固化。

动态填报项并不仅仅影响到个人报名，也影响团队报名以及批量导入与导出。


原则
^^^^^^^^^^^^^^^^^^

* 基本信息只有姓名、证件号码（通常为身份证，也可能是护照）
* 微信OpenID、手机号、推荐人、工作单位、性别是相对固定的
* 不同的身份可能引发不同的填报项（如学生不必填工作单位、上市公司人员需填写股票代码）
* 个人信息具有一定的延续性
* 支持报名模板，模板有基本的填报项设计
* 可以推导出来的信息不是必填项（如通过身份证号可推导出生日、年龄与性别）
* 在填报、导入、导出、分析时均需按照动态填报项进行动态生成
* 【待定】需要与学员中心信息互通

思路
^^^^^^^^^^^^^^^^^^

对于会议系统来讲，动态填报项针对每个学习会，有所不同。但对于动态填报项而言，本质是一组有相互关联关系的动态属性。

目前我们必须支持的固定内容包括，未注明“可变项”的，为不变项：

#. 姓名
#. 证件类型 + 证件号码（可多个）
#. 手机号码（可多个）
#. 性别
#. 推荐人
#. 生日
#. 所在单位（可变项）
#. 所在地区（可变项）

其他内容则为可配置项。

风险
^^^^^^^^^^^^^^^^^^

#. 通过自己的微信帮其他人报名，造成信息混乱
#. 失效内容延续，比如去年营业额，应当到今年底失效



前置条件
------------------

必须传递一个唯一值，如

::
    
    { type: "meeting", id: 10}


开发设计
-------------------

术语
^^^^^^^^^^^^^^^^^^

填报项
""""""""""""""""""

每一个填报项都是一个独立的数据项定义，这个数据包括：

* 字段名称，给每个字段一个唯一名称，编码是串通于所有填报项中的
* 标签，显示填写字段的中文名称
* 说明，对字段的描述，不用于显示
* 提示，在输入等填报项中，用于输入内容的提示
* 数据类型，如字符串、多段文本、整数、浮点数、布尔、枚举等
* 计算公式，由其他数据计算得出，如年龄，可由生日计算而出
* 正则表达式
* 最大值，仅用于数字型
* 最小值，仅用于数字型
* 是否必填
* 枚举值列表，包括名字与权重值，如

::

    [
        {name: "硕士研究生", weight: 100}, 
        {name: "大学本科", weight: 80}
    ]

* 是否允许其他，仅限于枚举数据类型
* 其他是否填写，仅限于枚举数据类型且允许其他项
* 是否允许多选，仅限于枚举数据类型
* 显示参数，内联、竖排、左右排
* 错误提示，可多个，如当正则不满足时，当最大值不满足时，等等
* 默认显示还是隐藏
* 是否允许重复，如手机、身份证号等不允许在同一个表单列表中重复

固定项
""""""""""""""""""

* 固定项即全局的填报项，可用于快速定义表单

表单定义
""""""""""""""""""

除了表单的名称、用途以外，表单就是一个填报项的集合，包括表单自定义的填报项与固定填报项。在一个表单中，固定填报项的所有内容都可以修改，但以下两个部分例外：

#. 字段名称
#. 数据类型

由于表单是与第三方应用紧密关联的，因此，需要加上用途一项。如前所示。

::

     { type: "meeting", id: 10}

表单定义后可生成填报二维码。


填报关系
""""""""""""""""""

表单定义中可包括填报关系，填报关系就是填报项与填报项之间的关系。

#. 当某个填报项等于、不等于、大于、小于某个值时，显示或者隐藏某些项
#. 当某个填报项等于、不等于、大于、小于某个值时，自动填写并固定某些项的值

表单模板
""""""""""""""""""

可以快速生成表单定义，以方便操作。

答卷
""""""""""""""""""

用户填写表单后的提交数据。除表单中的内容外，还须包括：

#. 提交时间
#. 提交方式，包括：微信、网页等


补充说明
------------------------

#. 需要考虑诸如地区选择等，多层级联的数据下载与性能问题
#. 微信中填报的错误提示需要优化，应包括从服务器中返回的判断信息
